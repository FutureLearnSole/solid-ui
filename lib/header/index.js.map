{"version":3,"sources":["../../src/header/index.ts"],"names":["initHeader","store","options","header","document","getElementById","pod","solidAuthClient","trackSession","rebuildHeader","session","user","webId","innerHTML","createBanner","appendChild","podLink","createElement","href","uri","classList","add","icon","createUserMenu","createLoginSignUpButtons","menu","banner","profileLoginButtonPre","createUserMenuButton","label","onClick","button","addEventListener","innerText","createUserMenuLink","link","fetcher","load","loggedInMenuList","createUserMenuItem","logout","loggedInMenu","setAttribute","loggedInMenuTrigger","type","profileImg","getProfileImg","loggedInMenuContainer","throttledMenuToggle","event","toggleMenu","timer","setTimeout","clearTimeout","child","menuProfileItem","profileUrl","widgets","findImage","emptyProfile","profileImage","style","backgroundImage","trigger","isExpanded","getAttribute","expand","close","toString"],"mappings":"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","sourcesContent":["/*\n    This file was copied from mashlib/src/global/header.ts file. It is modified to\n    work in solid-ui by adjusting where imported functions are found.\n */\nimport { IndexedFormula, NamedNode, sym } from 'rdflib'\nimport { loginStatusBox, solidAuthClient } from '../authn/authn'\nimport { widgets } from '../widgets'\nimport { icon } from './icon'\nimport { emptyProfile } from './empty-profile'\nimport { throttle, getPod } from './headerHelpers'\nimport { log } from '../debug'\n\n// SolidAuthorization, SolidClam, and SolidSession was copied from mashlib/typings/solid-auth-client\n// access_token, client_id, id_token, at_hash had to be converted to camelcase for typescript compatibility\ninterface SolidAuthorization {\n    accessToken: string;\n    clientId: string;\n    idToken: string;\n}\n\ninterface SolidClaim {\n    atHash: string;\n    aud: string;\n    azp: string;\n    cnf: {\n        jwk: string;\n    };\n    exp: number;\n    iat: number;\n    iss: string;\n    jti: string;\n    nonce: string;\n    sub: string;\n}\nexport interface SolidSession {\n    authorization: SolidAuthorization;\n    credentialType: string;\n    idClaims: SolidClaim;\n    idp: string;\n    issuer: string;\n    sessionKey: string;\n    webId: string;\n}\n\ntype Menu = {\n    label: string,\n    url: string\n}\ntype HeaderOptions = {\n    logo?: string,\n    menuList?: Menu[]\n}\nexport async function initHeader (store: IndexedFormula, options: HeaderOptions) {\n  const header = document.getElementById('PageHeader')\n  if (!header) {\n    return\n  }\n\n  const pod = getPod()\n  solidAuthClient.trackSession(rebuildHeader(header, store, pod, options))\n}\n\nfunction rebuildHeader (header: HTMLElement, store: IndexedFormula, pod: NamedNode, options: HeaderOptions) {\n  return async (session: SolidSession | null) => {\n    const user = session ? sym(session.webId) : null\n    header.innerHTML = ''\n    header.appendChild(await createBanner(store, pod, user, options))\n  }\n}\n\nasync function createBanner (store: IndexedFormula, pod: NamedNode, user: NamedNode | null, options: HeaderOptions): Promise<HTMLElement> {\n  const podLink = document.createElement('a')\n  podLink.href = pod.uri\n  podLink.classList.add('header-banner__link')\n  podLink.innerHTML = icon\n\n  const menu = user\n    ? await createUserMenu(store, user, options)\n    : createLoginSignUpButtons()\n\n  const banner = document.createElement('div')\n  banner.classList.add('header-banner')\n  banner.appendChild(podLink)\n  banner.appendChild(menu)\n\n  return banner\n}\n\nfunction createLoginSignUpButtons () {\n  const profileLoginButtonPre = document.createElement('div')\n  profileLoginButtonPre.classList.add('header-banner__login')\n  profileLoginButtonPre.appendChild(loginStatusBox(document, null, {}))\n  return profileLoginButtonPre\n}\n\nfunction createUserMenuButton (label: string, onClick: EventListenerOrEventListenerObject): HTMLElement {\n  const button = document.createElement('button')\n  button.classList.add('header-user-menu__button')\n  button.addEventListener('click', onClick)\n  button.innerText = label\n  return button\n}\n\nfunction createUserMenuLink (label: string, href: string): HTMLElement {\n  const link = document.createElement('a')\n  link.classList.add('header-user-menu__link')\n  link.href = href\n  link.innerText = label\n  return link\n}\n\nasync function createUserMenu (store: IndexedFormula, user: NamedNode, options: HeaderOptions): Promise<HTMLElement> {\n  const fetcher = (<any>store).fetcher\n  if (fetcher) {\n    // Making sure that Profile is loaded before building menu\n    await fetcher.load(user)\n  }\n  const loggedInMenuList = document.createElement('ul')\n  loggedInMenuList.classList.add('header-user-menu__list')\n  loggedInMenuList.appendChild(createUserMenuItem(createUserMenuLink('Show your profile', user.uri)))\n\n  loggedInMenuList.appendChild(createUserMenuItem(createUserMenuButton('Log out', () => solidAuthClient.logout())))\n\n  const loggedInMenu = document.createElement('nav')\n  loggedInMenu.classList.add('header-user-menu__navigation-menu')\n  loggedInMenu.setAttribute('aria-hidden', 'true')\n  loggedInMenu.appendChild(loggedInMenuList)\n\n  const loggedInMenuTrigger = document.createElement('button')\n  loggedInMenuTrigger.classList.add('header-user-menu__trigger')\n  loggedInMenuTrigger.type = 'button'\n  const profileImg = getProfileImg(store, user)\n  if (typeof profileImg === 'string') {\n    loggedInMenuTrigger.innerHTML = profileImg\n  } else {\n    loggedInMenuTrigger.appendChild(profileImg)\n  }\n\n  const loggedInMenuContainer = document.createElement('div')\n  loggedInMenuContainer.classList.add('header-banner__user-menu', 'header-user-menu')\n  loggedInMenuContainer.appendChild(loggedInMenuTrigger)\n  loggedInMenuContainer.appendChild(loggedInMenu)\n\n  const throttledMenuToggle = throttle((event: Event) => toggleMenu(event, loggedInMenuTrigger, loggedInMenu), 50)\n  loggedInMenuTrigger.addEventListener('click', throttledMenuToggle)\n  let timer = setTimeout(() => null, 0)\n  loggedInMenuContainer.addEventListener('mouseover', event => {\n    clearTimeout(timer)\n    throttledMenuToggle(event)\n  })\n  loggedInMenuContainer.addEventListener('mouseout', event => {\n    timer = setTimeout(() => throttledMenuToggle(event), 200)\n  })\n\n  return loggedInMenuContainer\n}\n\nfunction createUserMenuItem (child: HTMLElement): HTMLElement {\n  const menuProfileItem = document.createElement('li')\n  menuProfileItem.classList.add('header-user-menu__list-item')\n  menuProfileItem.appendChild(child)\n  return menuProfileItem\n}\n\nfunction getProfileImg (store: IndexedFormula, user: NamedNode): string | HTMLElement {\n  const profileUrl = null\n  try {\n    const profileUrl = widgets.findImage(user)\n    if (!profileUrl) {\n      return emptyProfile\n    }\n  } catch {\n    return emptyProfile\n  }\n\n  const profileImage = document.createElement('div')\n  profileImage.classList.add('header-user-menu__photo')\n  profileImage.style.backgroundImage = `url(\"${profileUrl}\")`\n  return profileImage\n}\n\nfunction toggleMenu (event: Event, trigger: HTMLButtonElement, menu: HTMLElement): void {\n  const isExpanded = trigger.getAttribute('aria-expanded') === 'true'\n  const expand = event.type === 'mouseover'\n  const close = event.type === 'mouseout'\n  if ((isExpanded && expand) || (!isExpanded && close)) {\n    return\n  }\n  trigger.setAttribute('aria-expanded', (!isExpanded).toString())\n  menu.setAttribute('aria-hidden', isExpanded.toString())\n}\n"],"file":"index.js"}